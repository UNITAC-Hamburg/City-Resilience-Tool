{
  "cells": [
    {
      "id": "fac5ba25-a7d0-40cb-9eba-cb0300988d72",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "",
      "source": "# City Resilience Profiling Tool - Domain Ontology\n\n\nWe rely on the following definitions of concepts in the CRPT domain:\n\n* **Urban Elements**: categorization of main aspects enabling life in the city, from Built Environment and Infrastructure to Municipal Public Services or Economy.\n* **Component**: subcategories of urban elements\n* **Indicators**: Indicators dedicated to assessing and characterizing each Urban Element performance (e.g. coverage and continuity of function of services).\n* **Shocks**: uncertain, abrupt, or long-onset events that have potential to impact upon the purpose or objective of an urban system.\n* **Stresses**: chronic and ongoing dynamic pressures originated within an urban system with potential for cumulative impacts on the ability and capacity of the system to achieve its objectives (e.g. environmental pollution, vegetation loss, informal economy).\n* **Challenges**: long-term contextual changes and pressures originated outside of the urban system, also undermine the city’s capacity for sustainability and resilience (e.g. climate change effects, intergovernmental coordination).\n* **Priority Matters**: main areas of concern for the city being analyzed (economic performance, water cycle mismanagement).\n* **Policies, plans and initiatives**: policies and plans in place or in development that may affect elements in the city (e.g: national, regional or local regulations).\n* **Stakeholders**: local government, public and private sector entities, civil society.\n\nTo present the relationships between these concepts, we have created the following ontology in ORM:\n\n![https://drive.google.com/uc?export=download&id=1CSUIXswH4le2zXR8OjhAMw1iUd-Nann9](https://drive.google.com/uc?export=download&id=1CSUIXswH4le2zXR8OjhAMw1iUd-Nann9)\n",
      "type": "markdown"
    },
    {
      "id": "6baa2858-864a-442d-a626-a8a39fa52cff",
      "inputs": [
      ],
      "isCodeFolded": true,
      "name": "",
      "source": "crpt ontology implementation",
      "type": "markdown"
    },
    {
      "id": "6c47cc6f-d811-401a-b29e-e3f0dcb5779d",
      "inputs": [
      ],
      "name": "un-crpt-model-component",
      "source": "entity Component row_to_component = row_from[components_csv]\ndef component_row = transpose[row_to_component]\ndef component = cell_from[component_row, components_csv]\n\ndef component_city = component:city\ndef component_element_code = component:element_code\ndef component_code = component:component_code\ndef component_name = component:component_name\n",
      "type": "install"
    },
    {
      "id": "db595b54-a910-4d18-b865-bf8926accfad",
      "inputs": [
      ],
      "name": "un-crpt-model-indicator",
      "source": "entity Indicator row_to_indicator = row_from[priority_matters_indicators_csv]\ndef indicator_row = transpose[row_to_indicator]\ndef indicator = cell_from[indicator_row, priority_matters_indicators_csv]\n\nentity Indicator row_to_indicator_2 = row_from[priority_matters_shocks_indicators_csv]\ndef indicator_row_2 = transpose[row_to_indicator_2]\ndef indicator = cell_from[indicator_row_2, priority_matters_shocks_indicators_csv]\n\ndef indicator_city = indicator:city\ndef indicator_prioritymatter = indicator:priority_matter . priority_matter_name_prioritymatter\ndef indicator_shock_subtype = indicator:shock . from_shock_subtype_name\ndef indicator_urbanelement = indicator:element_code . (transpose[urban_element_code])\ndef indicator_component = indicator:component_code . (transpose[component_code])\ndef indicator_code = indicator:indicator_code\ndef indicator_description = indicator:indicator_description\ndef indicator_value = indicator:indicator_value\n",
      "type": "install"
    },
    {
      "id": "90a9a552-ed8c-4798-896f-f0ccd930727f",
      "inputs": [
      ],
      "name": "un-crpt-model-organization",
      "source": "entity Organization row_to_organization = row_from[stakeholders_description_csv]\ndef organization_row = transpose[row_to_organization]\ndef organization = cell_from[organization_row, stakeholders_description_csv]\n\ndef organization_city = organization:city\ndef organization_name = organization:organization\ndef organization_description = organization:description\n",
      "type": "install"
    },
    {
      "id": "bdbae640-ea2e-4ce0-a416-0cef222c4f77",
      "inputs": [
      ],
      "name": "un-crpt-model-ppi",
      "source": "entity PPI row_to_ppi = row_from[ppi_csv]\ndef ppi_row = transpose[row_to_ppi]\ndef ppi = cell_from[ppi_row, ppi_csv]\n\ndef ppi = ppi:type\n\ndef Policy = p: ppi(p, \"Policy\")\ndef Plan = p: ppi(p, \"Plan\")\ndef Initiative = t: ppi(t, \"Initiative\")\n\ndef ppi_city = ppi:city\ndef ppi_description = ppi:description\ndef ppi_year = ppi:year\ndef ppi_status= ppi:status\ndef ppi_category= ppi:category\ndef ppi_url= ppi:url\n",
      "type": "install"
    },
    {
      "id": "e2f0ad2c-c4d4-4dde-8c19-ba599c80e79f",
      "inputs": [
      ],
      "name": "un-crpt-model-prioritymatter",
      "source": "entity PriorityMatter row_to_prioritymatter = row_from[priority_matters_csv]\ndef prioritymatter_row = transpose[row_to_prioritymatter]\ndef prioritymatter = cell_from[prioritymatter_row, priority_matters_csv]\n\n\ndef prioritymatter_city = prioritymatter:city\ndef prioritymatter_name = prioritymatter:priority_matter\n\ndef prioritymatter_shock_subtype(pm, sh) =  \n    shocks_prioritymatters_csv(:priority_matter, r, pm_n) and \n    shocks_prioritymatters_csv(:shock, r, sh_n) and \n    prioritymatter:priority_matter(pm, pm_n) and\n    sh = from_shock_subtype_name[sh_n]\n    from pm_n, sh_n, r\ndef shock_subtype_prioritymatter = transpose[prioritymatter_shock_subtype]\ndef priority_matter_name_prioritymatter = transpose[prioritymatter:priority_matter]\n",
      "type": "install"
    },
    {
      "id": "ac60d889-386e-4131-8e2e-d37ecac131a1",
      "inputs": [
      ],
      "name": "un-crpt-model-relationship_role",
      "source": "entity RelationshipRole from_role_name = urbanunderperformance_stakeholders_csv:role\n",
      "type": "install"
    },
    {
      "id": "e7ccff69-ade6-49f7-9d3f-8a5433fc2bce",
      "inputs": [
      ],
      "name": "un-crpt-model-shock_classifiers",
      "source": "entity SockGroup from_shock_group_name = {\n    \"BIOLOGICAL\";\n    \"NATURAL\";\n    \"ENVIRONMENTAL\";\n    \"SOCIETAL\";\n    \"TECHNOLOGICAL\";\n    \"COMPLEX\";\n}\n\nentity ShockType from_shock_type_name = {\n    \"INFECTIOUS DISEASES\";\n    \"INFESTATION\";\n    \"DROUGHT\";\n    \"EXTREME METEOROLOGICAL CONDITIONS\";\n    \"WILDFIRE\";\n    \"EARTHQUAKE\";\n    \"MASS MOVEMENT\";\n    \"VOLCANIC ACTIVITY\";\n    \"FLOOD\";\n    \"STORM\";\n    \"WAVE ACTION\";\n    \"WATER-SOIL DEGRADATION\";\n    \"AIR POLLUTION\";\n    \"EROSION\";\n    \"BIODIVERSITY LOSS\";\n    \"SOCIO-ECONOMIC SHOCKS\";\n    \"SOCIO-SPATIAL SHOCKS\";\n    \"SOCIO-CULTURAL SHOCKS\";\n    \"SOCIO-POLITICAL SHOCKS\";\n    \"CRIME\";\n    \"CYBER-ATTACK\";\n    \"TERRORISM\";\n    \"CONFLICT\";\n    \"INDUSTRIAL & MINING INCIDENT\";\n    \"NON-INDUSTRIAL INCIDENT\";\n    \"FAILURE OF INFRASTRUCTURE & SERVICES\";\n    \"FAILURE OF SUPPLIES\";\n}\n\nentity ShockSubType from_shock_subtype_name = {\n    \"Viral Epidemic & Pandemic Disease\";\n    \"Bacterial Epidemic & Pandemic Disease\";\n    \"Parasitic Epidemic & Pandemic Disease\";\n    \"Fungal Epidemic & Pandemic Disease\";\n    \"Prion Epidemic & Pandemic Disease\";\n    \"Insect Infestation\";\n    \"Animal, Plant, Fungal & Pest Infestation\";\n    \"Drought\";\n    \"Heat Wave\";\n    \"Cold Wave\";\n    \"Extreme Winter Conditions\";\n    \"Fog\";\n    \"Land Fire\";\n    \"Forest Fire\";\n    \"Ground Shaking\";\n    \"Rockfall\";\n    \"Landslide\";\n    \"Avalanche\";\n    \"Soil Liquefaction\";\n    \"Subsidence\";\n    \"Volcanic Activity\";\n    \"Volcanic Eruption\";\n    \"Flash Flood\";\n    \"Fluvial Flood\";\n    \"Groundwater Flood\";\n    \"Pluvial Flood\";\n    \"Coastal Flood\";\n    \"Glacial Lake Outburst\";\n    \"Ice Jam Flood\";\n    \"Tropical Storm\";\n    \"Extra-Tropical Storm\";\n    \"Local/Convective Storm\";\n    \"Geomagnetic Storm\";\n    \"Tsunami\";\n    \"High Swells & Rogue Waves\";\n    \"Seiche\";\n    \"Soil Degradation\";\n    \"Water Body Degradation\";\n    \"Sudden Pollution of the Air\";\n    \"Sudden Inland Erosion\";\n    \"Sudden Coastal Erosion\";\n    \"Biodiversity Loss\";\n    \"Economic Crisis\";\n    \"Financial Crisis\";\n    \"Mass Immigration\";\n    \"Mass Outward Displacement\";\n    \"Destruction of Cultural Heritage\";\n    \"Political Crisis\";\n    \"Violent Crime\";\n    \"Cyber-Attack\";\n    \"Terrorism\";\n    \"Urban Conflict\";\n    \"Inter-State Conflict\";\n    \"Chemical Spill\";\n    \"Collapse\";\n    \"Explosion\";\n    \"Fire\";\n    \"Gas Leak\";\n    \"Oil Spill\";\n    \"Poisoning\";\n    \"Radiation\";\n    \"Explosion\";\n    \"Urban Fire\";\n    \"Transport Incident\";\n    \"Basic Infrastructure Breakdown\";\n    \"Built Infrastructure Breakdown\";\n    \"Public Services Breakdown\";\n    \"Mobility System Breakdown\";\n    \"Food Crisis\";\n    \"Water Crisis\";\n    \"Energy Crisis\";\n}\n\ndef shock_group_contains_shock_type = transpose[shock_type_belongs_to_shock_group]\ndef shock_type_belongs_to_shock_group = {\n    from_shock_type_name[\"INFECTIOUS DISEASES\"], from_shock_group_name[\"BIOLOGICAL\"];\n    from_shock_type_name[\"INFESTATION\"], from_shock_group_name[\"BIOLOGICAL\"];\n    from_shock_type_name[\"DROUGHT\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"EXTREME METEOROLOGICAL CONDITIONS\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"WILDFIRE\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"EARTHQUAKE\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"MASS MOVEMENT\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"VOLCANIC ACTIVITY\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"FLOOD\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"STORM\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"WAVE ACTION\"], from_shock_group_name[\"NATURAL\"];\n    from_shock_type_name[\"WATER-SOIL DEGRADATION\"], from_shock_group_name[\"ENVIRONMENTAL\"];\n    from_shock_type_name[\"AIR POLLUTION\"], from_shock_group_name[\"ENVIRONMENTAL\"];\n    from_shock_type_name[\"EROSION\"], from_shock_group_name[\"ENVIRONMENTAL\"];\n    from_shock_type_name[\"BIODIVERSITY LOSS\"], from_shock_group_name[\"ENVIRONMENTAL\"];\n    from_shock_type_name[\"SOCIO-ECONOMIC SHOCKS\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"SOCIO-SPATIAL SHOCKS\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"SOCIO-CULTURAL SHOCKS\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"SOCIO-POLITICAL SHOCKS\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"CRIME\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"CYBER-ATTACK\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"TERRORISM\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"CONFLICT\"], from_shock_group_name[\"SOCIETAL\"];\n    from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"], from_shock_group_name[\"TECHNOLOGICAL\"];\n    from_shock_type_name[\"NON-INDUSTRIAL INCIDENT\"], from_shock_group_name[\"TECHNOLOGICAL\"];\n    from_shock_type_name[\"FAILURE OF INFRASTRUCTURE & SERVICES\"], from_shock_group_name[\"TECHNOLOGICAL\"];\n    from_shock_type_name[\"FAILURE OF SUPPLIES\"], from_shock_group_name[\"COMPLEX\"];\n}\n\ndef shock_type_contains_shock_subtype = transpose[shock_subtype_belongs_to_shock_type]\ndef shock_subtype_belongs_to_shock_type = {\n    from_shock_subtype_name[\"Viral Epidemic & Pandemic Disease\"], from_shock_type_name[\"INFECTIOUS DISEASES\"];\n    from_shock_subtype_name[\"Bacterial Epidemic & Pandemic Disease\"], from_shock_type_name[\"INFECTIOUS DISEASES\"];\n    from_shock_subtype_name[\"Parasitic Epidemic & Pandemic Disease\"], from_shock_type_name[\"INFECTIOUS DISEASES\"];\n    from_shock_subtype_name[\"Fungal Epidemic & Pandemic Disease\"], from_shock_type_name[\"INFECTIOUS DISEASES\"];\n    from_shock_subtype_name[\"Prion Epidemic & Pandemic Disease\"], from_shock_type_name[\"INFECTIOUS DISEASES\"];\n    from_shock_subtype_name[\"Insect Infestation\"], from_shock_type_name[\"INFESTATION\"];\n    from_shock_subtype_name[\"Animal, Plant, Fungal & Pest Infestation\"], from_shock_type_name[\"INFESTATION\"];\n    from_shock_subtype_name[\"Drought\"], from_shock_type_name[\"DROUGHT\"];\n    from_shock_subtype_name[\"Heat Wave\"], from_shock_type_name[\"EXTREME METEOROLOGICAL CONDITIONS\"];\n    from_shock_subtype_name[\"Cold Wave\"], from_shock_type_name[\"EXTREME METEOROLOGICAL CONDITIONS\"];\n    from_shock_subtype_name[\"Extreme Winter Conditions\"], from_shock_type_name[\"EXTREME METEOROLOGICAL CONDITIONS\"];\n    from_shock_subtype_name[\"Fog\"], from_shock_type_name[\"EXTREME METEOROLOGICAL CONDITIONS\"];\n    from_shock_subtype_name[\"Land Fire\"], from_shock_type_name[\"WILDFIRE\"];\n    from_shock_subtype_name[\"Forest Fire\"], from_shock_type_name[\"WILDFIRE\"];\n    from_shock_subtype_name[\"Ground Shaking\"], from_shock_type_name[\"EARTHQUAKE\"];\n    from_shock_subtype_name[\"Rockfall\"], from_shock_type_name[\"MASS MOVEMENT\"];\n    from_shock_subtype_name[\"Landslide\"], from_shock_type_name[\"MASS MOVEMENT\"];\n    from_shock_subtype_name[\"Avalanche\"], from_shock_type_name[\"MASS MOVEMENT\"];\n    from_shock_subtype_name[\"Soil Liquefaction\"], from_shock_type_name[\"MASS MOVEMENT\"];\n    from_shock_subtype_name[\"Subsidence\"], from_shock_type_name[\"MASS MOVEMENT\"];\n    from_shock_subtype_name[\"Volcanic Activity\"], from_shock_type_name[\"VOLCANIC ACTIVITY\"];\n    from_shock_subtype_name[\"Volcanic Eruption\"], from_shock_type_name[\"VOLCANIC ACTIVITY\"];\n    from_shock_subtype_name[\"Flash Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Fluvial Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Groundwater Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Pluvial Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Coastal Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Glacial Lake Outburst\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Ice Jam Flood\"], from_shock_type_name[\"FLOOD\"];\n    from_shock_subtype_name[\"Tropical Storm\"], from_shock_type_name[\"STORM\"];\n    from_shock_subtype_name[\"Extra-Tropical Storm\"], from_shock_type_name[\"STORM\"];\n    from_shock_subtype_name[\"Local/Convective Storm\"], from_shock_type_name[\"STORM\"];\n    from_shock_subtype_name[\"Geomagnetic Storm\"], from_shock_type_name[\"STORM\"];\n    from_shock_subtype_name[\"Tsunami\"], from_shock_type_name[\"WAVE ACTION\"];\n    from_shock_subtype_name[\"High Swells & Rogue Waves\"], from_shock_type_name[\"WAVE ACTION\"];\n    from_shock_subtype_name[\"Seiche\"], from_shock_type_name[\"WAVE ACTION\"];\n    from_shock_subtype_name[\"Soil Degradation\"], from_shock_type_name[\"WATER-SOIL DEGRADATION\"];\n    from_shock_subtype_name[\"Water Body Degradation\"], from_shock_type_name[\"WATER-SOIL DEGRADATION\"];\n    from_shock_subtype_name[\"Sudden Pollution of the Air\"], from_shock_type_name[\"AIR POLLUTION\"];\n    from_shock_subtype_name[\"Sudden Inland Erosion\"], from_shock_type_name[\"EROSION\"];\n    from_shock_subtype_name[\"Sudden Coastal Erosion\"], from_shock_type_name[\"EROSION\"];\n    from_shock_subtype_name[\"Biodiversity Loss\"], from_shock_type_name[\"BIODIVERSITY LOSS\"];\n    from_shock_subtype_name[\"Economic Crisis\"], from_shock_type_name[\"SOCIO-ECONOMIC SHOCKS\"];\n    from_shock_subtype_name[\"Financial Crisis\"], from_shock_type_name[\"SOCIO-ECONOMIC SHOCKS\"];\n    from_shock_subtype_name[\"Mass Immigration\"], from_shock_type_name[\"SOCIO-SPATIAL SHOCKS\"];\n    from_shock_subtype_name[\"Mass Outward Displacement\"], from_shock_type_name[\"SOCIO-SPATIAL SHOCKS\"];\n    from_shock_subtype_name[\"Destruction of Cultural Heritage\"], from_shock_type_name[\"SOCIO-CULTURAL SHOCKS\"];\n    from_shock_subtype_name[\"Political Crisis\"], from_shock_type_name[\"SOCIO-POLITICAL SHOCKS\"];\n    from_shock_subtype_name[\"Violent Crime\"], from_shock_type_name[\"CRIME\"];\n    from_shock_subtype_name[\"Cyber-Attack\"], from_shock_type_name[\"CYBER-ATTACK\"];\n    from_shock_subtype_name[\"Terrorism\"], from_shock_type_name[\"TERRORISM\"];\n    from_shock_subtype_name[\"Urban Conflict\"], from_shock_type_name[\"CONFLICT\"];\n    from_shock_subtype_name[\"Inter-State Conflict\"], from_shock_type_name[\"CONFLICT\"];\n    from_shock_subtype_name[\"Chemical Spill\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Collapse\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Explosion\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Fire\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Gas Leak\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Oil Spill\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Poisoning\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Radiation\"], from_shock_type_name[\"INDUSTRIAL & MINING INCIDENT\"];\n    from_shock_subtype_name[\"Explosion\"], from_shock_type_name[\"NON-INDUSTRIAL INCIDENT\"];\n    from_shock_subtype_name[\"Urban Fire\"], from_shock_type_name[\"NON-INDUSTRIAL INCIDENT\"];\n    from_shock_subtype_name[\"Transport Incident\"], from_shock_type_name[\"NON-INDUSTRIAL INCIDENT\"];\n    from_shock_subtype_name[\"Basic Infrastructure Breakdown\"], from_shock_type_name[\"FAILURE OF INFRASTRUCTURE & SERVICES\"];\n    from_shock_subtype_name[\"Built Infrastructure Breakdown\"], from_shock_type_name[\"FAILURE OF INFRASTRUCTURE & SERVICES\"];\n    from_shock_subtype_name[\"Public Services Breakdown\"], from_shock_type_name[\"FAILURE OF INFRASTRUCTURE & SERVICES\"];\n    from_shock_subtype_name[\"Mobility System Breakdown\"], from_shock_type_name[\"FAILURE OF INFRASTRUCTURE & SERVICES\"];\n    from_shock_subtype_name[\"Food Crisis\"], from_shock_type_name[\"FAILURE OF SUPPLIES\"];\n    from_shock_subtype_name[\"Water Crisis\"], from_shock_type_name[\"FAILURE OF SUPPLIES\"];\n    from_shock_subtype_name[\"Energy Crisis\"], from_shock_type_name[\"FAILURE OF SUPPLIES\"];\n}\n\ndef shock_subtype_description = {\n    from_shock_subtype_name[\"Viral Epidemic & Pandemic Disease\"], \"E.g., Rubella/Measles, Small Pox/Variola, Hands, Foot and Mouth Disease (HFMD), Chikungunya, Rift Valley fever, Zica Virus, Influenza, Hepatitis, HIV AIDs and other sexually transmitted diseases.\";\n    from_shock_subtype_name[\"Bacterial Epidemic & Pandemic Disease\"], \"E.g., Salmonella, Cholera and Tuberculosis.\";\n    from_shock_subtype_name[\"Parasitic Epidemic & Pandemic Disease\"], \"E.g., Malaria, Chagas Disease, Giardiasis and Trichinellosis.\";\n    from_shock_subtype_name[\"Fungal Epidemic & Pandemic Disease\"], \"E.g., Pneumonia and Fungal Meningitis.\";\n    from_shock_subtype_name[\"Prion Epidemic & Pandemic Disease\"], \"E.g., Bovine Spongiform Encephalopathy (BSE), Creutzfeldt- Jakob-Disease (CJD) and Kuru.\";\n    from_shock_subtype_name[\"Insect Infestation\"], \"E.g., Grasshoppers, Locus, African Bees, Coleoptera (beetles).\";\n    from_shock_subtype_name[\"Animal, Plant, Fungal & Pest Infestation\"], \",E.g., Worms, Rats, Grain-Eating Birds and Rabbit Infestation, Fungal Contamination, noxious or injurious invasive plants (e.g., Kudzu vine).\";\n    from_shock_subtype_name[\"Drought\"], \"An extended period of unusually low precipitation that produces shortage of water for people, animals and plants. The degree of precipitation reduction that constitutes a drought varies by locality, climate and environmental sector.\";\n    from_shock_subtype_name[\"Heat Wave\"], \"Periods of abnormally hot and/or unusually humid weather.\";\n    from_shock_subtype_name[\"Cold Wave\"], \"Periods of abnormally cold weather that may be aggravated by high winds.\";\n    from_shock_subtype_name[\"Extreme Winter Conditions\"], \"Extreme winter meteorological conditions such as frost, freeze, snow, and ice.\";\n    from_shock_subtype_name[\"Fog\"], \"Severe fog events.\";\n    from_shock_subtype_name[\"Land Fire\"], \"Wildfires are unplanned vegetation fires than may happen in land (bush, brush, grassland, scrub and pasture) and forest areas.\";\n    from_shock_subtype_name[\"Forest Fire\"], \"Wildfires are unplanned vegetation fires than may happen in land (bush, brush, grassland, scrub and pasture) and forest areas.\";\n    from_shock_subtype_name[\"Ground Shaking\"], \"Ground shaking are the result of sudden movements of blocks of the Earth’s crust along geological faults.\";\n    from_shock_subtype_name[\"Rockfall\"], \"Falling of newly detached mass of rock of any dimension from a cliff or down a very steep slope, caused by factors such as ice wedging, root growth, ground shaking or erosion.\";\n    from_shock_subtype_name[\"Landslide\"], \"Moderate to rapid soil or debris movement, that includes phenomena such as mudflows, mudslides and debris flows.\";\n    from_shock_subtype_name[\"Avalanche\"], \"Mass of snow, ice, debris and/or rocks, flowing and sliding rapidly down a steep slope.\";\n    from_shock_subtype_name[\"Soil Liquefaction\"], \"The transformation of water-saturated soil from a solid state to a liquid state caused by an earthquake. Liquefaction reduces the strength and stiness of soil causing heavy structures (e.g., buildings) to sink and light structures (e.g., underground pipes and tanks), to rise up to the ground surface.\";\n    from_shock_subtype_name[\"Subsidence\"], \"Sinking of the ground due to groundwater removal, mining, dissolution of limestone (e.g., karst, sinkholes), earthquakes, among others.\";\n    from_shock_subtype_name[\"Volcanic Activity\"], \"Hazardous volcanic activity occuring during eruptions, such as lava and pyroclastic flows and the ejection of pyroclastic material/tephra and poisonous gases; as well as volcanic activity that occurs in-between eruptions (e.g., lahar and hydrothermal explosions).\";\n    from_shock_subtype_name[\"Volcanic Eruption\"], \"Hazardous volcanic activity occuring during eruptions, such as lava and pyroclastic flows and the ejection of pyroclastic material/tephra and poisonous gases; as well as volcanic activity that occurs in-between eruptions (e.g., lahar and hydrothermal explosions).\";\n    from_shock_subtype_name[\"Flash Flood\"], \"Heavy or excessive rainfall in a short period of time that produce immediate runoff, creating flooding conditions within minutes or a few hours during or after the rainfall.\";\n    from_shock_subtype_name[\"Fluvial Flood\"], \"Type of flood resulting from the overflow of water from a stream or river channel onto normally dry land in the floodplain adjacent to the channel.\";\n    from_shock_subtype_name[\"Groundwater Flood\"], \"Groundwater flooding occurs when the natural underground drainage system cannot drain rainfall away quick enough, causing the water table to rise above the ground surface.\";\n    from_shock_subtype_name[\"Pluvial Flood\"], \"Pluvial flooding occurs when an extremely heavy rainfall saturates drainage systems and the excess water cannot be absorbed.\";\n    from_shock_subtype_name[\"Coastal Flood\"], \"Higher-than-normal water levels along the coast caused by tidal changes or thunderstorms that result in flooding, which can last from days to weeks\";\n    from_shock_subtype_name[\"Glacial Lake Outburst\"], \"A flood that occurs when water dammed by a glacier or moraine is suddenly released.\";\n    from_shock_subtype_name[\"Ice Jam Flood\"], \"Type of flood occuring when an accumulation of floating ice restrict or block a river’s flow and drainage.\";\n    from_shock_subtype_name[\"Tropical Storm\"], \"e.g. cyclones, hurricanes and typhoons.\";\n    from_shock_subtype_name[\"Extra-Tropical Storm\"], \"e.g. European winter/windstorm and Nor’easter.\";\n    from_shock_subtype_name[\"Local/Convective Storm\"], \"e.g. Electrical storms or thunderstorms, rainstorms, windstorms, snowstorms and blizzard, tornadoes and dust and sandstorms.\";\n    from_shock_subtype_name[\"Geomagnetic Storm\"], \"Storm caused by solar wind shockwaves that temporarily disturb the Earth’s magnetosphere. Geomagnetic storms can disrupt power grids, spacecraft operations, and satellite communications.\";\n    from_shock_subtype_name[\"Tsunami\"], \"High waves in ocean or in semi- or fully-enclosed bodies of water, such as lakes or bays, that may damage boats and coastal infrastructure, contributing to flooding and erosion. Usually generated by strong winds (e.g. ocean swells, rogue waves and seiches) or by underwater earthquakes, volcanic eruptions or landslides (e.g. tsunamis).\";\n    from_shock_subtype_name[\"High Swells & Rogue Waves\"], \"High waves in ocean or in semi- or fully-enclosed bodies of water, such as lakes or bays, that may damage boats and coastal infrastructure, contributing to flooding and erosion. Usually generated by strong winds (e.g. ocean swells, rogue waves and seiches) or by underwater earthquakes, volcanic eruptions or landslides (e.g. tsunamis).\";\n    from_shock_subtype_name[\"Seiche\"], \"High waves in ocean or in semi- or fully-enclosed bodies of water, such as lakes or bays, that may damage boats and coastal infrastructure, contributing to flooding and erosion. Usually generated by strong winds (e.g. ocean swells, rogue waves and seiches) or by underwater earthquakes, volcanic eruptions or landslides (e.g. tsunamis).\";\n    from_shock_subtype_name[\"Soil Degradation\"], \"Soil degradation happens when the soil suddenly loses its value (in terms of nutrients, chemical make-up etc) as a result of acidification, over-farming, over-grazing, deforestation, desertification or erosion. \";\n    from_shock_subtype_name[\"Water Body Degradation\"], \"Water sudden physical changes, such as elevation of the temperature, discoloration, turbidity, siltation, depletion of oxygen (anoxia), salt-water intrusion and acidification, among others.\";\n    from_shock_subtype_name[\"Sudden Pollution of the Air\"], \"Air pollution is the introduction of particulates, biological molecules, or other harmful materials into Earth's atmosphere, causing health issues and contributing to photochemical smog and acid rain, corrosion of buildings and damaging of trees and crops. Natural sources of Air pollution includes volcanic activity, methane from livestock, or dust from regions with little or no vegetation.\";\n    from_shock_subtype_name[\"Sudden Inland Erosion\"], \"Natural temporary or permanent removal of soil or rock materials by the effect of rainfall (e.g., on  riverbanks), wind, moving ice, and of infiltrating water that dissolves rock (e.g., in limestone and young volcanic ash geological formations). Coastal erosion further includes erosion due to the action of tides and sea waves. \";\n    from_shock_subtype_name[\"Sudden Coastal Erosion\"], \"Natural temporary or permanent removal of soil or rock materials by the effect of rainfall (e.g., on  riverbanks), wind, moving ice, and of infiltrating water that dissolves rock (e.g., in limestone and young volcanic ash geological formations). Coastal erosion further includes erosion due to the action of tides and sea waves. \";\n    from_shock_subtype_name[\"Biodiversity Loss\"], \"e.g. degradation of biodiversity, species extinction, major changes on species distribution.\";\n    from_shock_subtype_name[\"Economic Crisis\"], \"Economic crisis is an urgent and structural threat, at the regional and/or national levels, that necessitates urgent and alternative courses of action, but that also impacts the city’s economic sector (e.g., inflation due to changes in oil-price, due to the decline of currencies, disruptions on import and export of goods and services).\";\n    from_shock_subtype_name[\"Financial Crisis\"], \"A sudden economic recession or depression caused by a lack of necessary liquidity in financial institutions. A financial crisis may be caused by natural disasters, negative economic news, or some other event with a significant financial impact. Financial crises tend to cause decreases in business activities, leading to a self-reinforcing intensification of the crisis.\";\n    from_shock_subtype_name[\"Mass Immigration\"], \"Mass population immigration is the movement of people in the city, with the intention of settling in, temporarily or permanently. Mass Outward Displacement is its exact opposite, as movement of people goes out of the city.\";\n    from_shock_subtype_name[\"Mass Outward Displacement\"], \"Mass population immigration is the movement of people in the city, with the intention of settling in, temporarily or permanently. Mass Outward Displacement is its exact opposite, as movement of people goes out of the city.\";\n    from_shock_subtype_name[\"Destruction of Cultural Heritage\"], \"Destruction or desecration of cultural heritage or of sacred sites and symbols (e.g., temples, churches, sacred land and national symbols). \";\n    from_shock_subtype_name[\"Political Crisis\"], \"Political crisis is an urgent and structural threat, at the local, regional and/or national political levels, that necessitates urgent and alternative courses of action, and that impacts the city’s normal functioning.\";\n    from_shock_subtype_name[\"Violent Crime\"], \"Suddent criminal events such as waves of violent personal crimes, waves of crimes against property, massacre or extermination.\";\n    from_shock_subtype_name[\"Cyber-Attack\"], \"Cyber-attacks are offensive maneuvers, employed by individuals or organizations, directed at computers or other devices, or attacks where computers or other devices are integral to the offence. These include hacking, massive fraud and data theft, espionage, etc.\";\n    from_shock_subtype_name[\"Terrorism\"], \"Terrorism is the systematic use of terror, through violent acts or false alarms, exploiting human fear, as a way of trying to achieve political, ethnical, economic and/or religious goals. It may encompass biological, chemical, or bomb attacks, hijacking or shootings.\";\n    from_shock_subtype_name[\"Urban Conflict\"], \"Conflict occuring in cities between different groups that may be caused by ethnicity, nationalism, religion, class or race.\";\n    from_shock_subtype_name[\"Inter-State Conflict\"], \"Conflict between state governments, potentially leading to war or armed conflict.\";\n    from_shock_subtype_name[\"Chemical Spill\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Collapse\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Explosion\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Fire\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Gas Leak\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Oil Spill\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Poisoning\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Radiation\"], \"Industrial and mining incidents encompass events such as the collapse, fire, explosion and primary radiation release from these sites and facilities, including the collapse of residual industrial and mining dams and landfills. It may happen due to accidents, negligence, incompetence, or has a consequence of another hazard (e.g., earthquakes). It further comprises chemical spills, gas leaks, oil spills, gas flaring and the poisoning of the environment due to industrial activities.\";\n    from_shock_subtype_name[\"Explosion\"], \"Non-industrial explosions include the explosion of old war munitions and of unexploded mines and ordnances (UXO).\";\n    from_shock_subtype_name[\"Urban Fire\"], \"Urban fires encompass uncontrolled fire within urban areas, affecting residential and/or commercial facilities. \";\n    from_shock_subtype_name[\"Transport Incident\"], \"Transport incidents encompass events caused by accidents, weather conditions, mechanical failure, incompetence or negligence, on air, road, railway and water. These include the transport of hazardous material such as fireworks, gases like LPG, fuels like diesel or petrol, acids and alkalis, industrial solvents, animal remedies, cleaning fluids and chemicals used in manufacturing.\";\n    from_shock_subtype_name[\"Basic Infrastructure Breakdown\"], \"Breakdown or collapse of basic infrastructure, such as water, energy, solid waste, wastewater or communication systems.\";\n    from_shock_subtype_name[\"Built Infrastructure Breakdown\"], \"Collapse of the city's built environment, e.g. major damages on residential, commercial and public facilities and/or infrastructure.\";\n    from_shock_subtype_name[\"Public Services Breakdown\"], \"Breakdown or collapse of public services, e.g. hospitals and clinics, emergency and rescue services, education facilities or social care services.\";\n    from_shock_subtype_name[\"Mobility System Breakdown\"], \"Breakdown or collapse of mobility system, including related infrastructure (e.g., bridge and tunnel collapses, breakdown of the city's railway), for systems based on water, air or land.\";\n    from_shock_subtype_name[\"Food Crisis\"], \"A food crisis occurs when the population’s access to appropriate quantities and quality of food and nutrition becomes inadequate or unreliable. It can encompass, besides food scarcity, natural and accidental events such as chemical, biological and foreign body food contamination.\";\n    from_shock_subtype_name[\"Water Crisis\"], \"A water crisis is a significant decline in the availability of acceptable quantity and quality of drinking water for both population (maintaining health and livelihoods) and economic activities. It can also encompass competition and conflicts situations over access to water, not only by different sectors (e.g., agriculture, industry and tourism) but also across boundaries (e.g., conflicts in transboundary river basins).\";\n    from_shock_subtype_name[\"Energy Crisis\"], \"An energy crisis is often a significant reduction in the supply and/or a substantial price increase of energy resources (e.g., electricity, fuel and gas). It may be caused by market fluctuations, limitations on free trade, nationalisation of energy companies, shortages or disruptions on the operation of energy producers and distribution networks (e.g., due to accidents or sabotage) and natural conditions (e.g., a severe winter).\";\n}\n\ndef shock_group_contains_shock_subtype = transpose[shock_subtype_belongs_to_shock_group]\ndef shock_subtype_belongs_to_shock_group(sst, sg) = \n    shock_subtype_belongs_to_shock_type(sst, st) and\n    shock_type_belongs_to_shock_group(st, sg)\n    from st\n",
      "type": "install"
    },
    {
      "id": "08560499-990e-4cfd-acfe-d5a8934d24e1",
      "inputs": [
      ],
      "name": "un-crpt-model-shock_impact",
      "source": "entity ShockImpact row_to_shock_impact = row_from[shocks_csv]\ndef shock_impact_row = transpose[row_to_shock_impact]\ndef shock_impact = cell_from[shock_impact_row, shocks_csv]\n// Similarly, here could be added shock occurrences from other locations as well\n// by employing the pattern shown in lines 1-3\n\ndef shock_impact_id = shock_impact:id\ndef shock_subtype_to_impact = transpose[shock_impact_subtype]\ndef shock_impact_subtype(s, st) = \n    shock_impact:subtype(s, stn) and \n    st = from_shock_subtype_name[stn] \n    from stn\ndef shock_impact(s, t) =\n    shock_impact_subtype(s, st) and \n    shock_subtype_belongs_to_shock_type(st, t)\n    from st\ndef shock_impact_group(s, g) =\n    shock_impact(s, t) and \n    shock_type_belongs_to_shock_group(t, g)\n    from t\n\ndef shock_impact_city = shock_impact:city\ndef shock_impact_date = shock_impact:date\ndef shock_impact_people_directly_affected = shock_impact:people_directly_affected\ndef shock_impact_people_indirectly_affected = shock_impact:people_indirectly_affected\ndef shock_impact_caused_shock = shock_impact:triggered_shock\ndef shock_impact_caused_by_shock = transpose[shock_impact_caused_shock] \ndef shock_impact_affected_urban_elements_list = shock_impact:urban_elements\ndef shock_impact_affected_urban_elements[s] = string_trim[split_string[shock_impact_affected_urban_elements_list[s]][_]]\ndef shock_impact_number_of_casualties = shock_impact:casualties\ndef shock_impact_number_of_injured = shock_impact:injured\ndef shock_impact_number_of_displaced = shock_impact:displaced\ndef shock_impact_loss_of_working_days = shock_impact:loss_of_working_days\ndef shock_impact_loss_of_jobs = shock_impact:loss_of_jobs\n\n\n// Helper rule to split CSV values\n@inline \ndef split_string[a_string] = regex_match_all[\"[ a-zA-Z0-9]+\", a_string]\n\n// TODO add IC to check consistency of group-type-subtype wrt. the structure we \n// already have\n",
      "type": "install"
    },
    {
      "id": "d2be9866-c357-4fbf-b923-5bffefb6571a",
      "inputs": [
      ],
      "name": "un-crpt-model-stress",
      "source": "entity StressType row_to_stress = row_from[stresses_csv]\ndef stress_row = transpose[row_to_stress]\ndef stress = cell_from[stress_row, stresses_csv]\n\ndef stress_city = stress:city\ndef stress_name = stress:stress\ndef stress_from_name = transpose[stress_name]\n\n// entity StressType row_to_stress2 = row_from[urbanunderperformance_stresses_indicators_csv]\n// def stress_row2 = transpose[row_to_stress2]\n// def stress = cell_from[stress_row2, urbanunderperformance_stresses_indicators_csv]\n\n// city;priority_matter;stress;stressor;element_code;component_code;indicator_code;indicator_description;indicator_value\n\n// entity StressType stress_from_name = stressors_stresses_csv[:stress, _]\n// entity StressType stress_from_name = stresses_prioritymatters_csv[:stress, _]\n// entity StressType stress_from_name = stresses_urbanelements_csv[:stress, _]\n\n\n\ndef stress_urban_element_code(st, e_c) =\n    urbanunderperformance_stresses_indicators_csv(:element_code, r, e_c) and\n    urbanunderperformance_stresses_indicators_csv(:stress, r, st_n) and\n    st = stress_from_name[st_n]\n    from st_n, r\n\ndef stress_component_code(st, c_c) =\n    urbanunderperformance_stresses_indicators_csv(:component_code, r, c_c) and\n    urbanunderperformance_stresses_indicators_csv(:stress, r, st_n) and\n    st = stress_from_name[st_n]\n    from st_n, r\n\ndef stress_prioritymatter(st, pm) = \n    urbanunderperformance_stresses_indicators_csv(:priority_matter, r, pm_n) and \n    urbanunderperformance_stresses_indicators_csv(:stress, r, st_n) and \n    prioritymatter:priority_matter(pm, pm_n) and \n    st = stress_from_name[st_n]\n    from pm_n, r, st_n\ndef prioritymatter_stress = transpose[stress_prioritymatter]\n\ndef indicator_stress = indicator_prioritymatter . prioritymatter_stress\n",
      "type": "install"
    },
    {
      "id": "10004510-eb58-4d6b-aae5-a8856735cda9",
      "inputs": [
      ],
      "name": "un-crpt-model-stressor",
      "source": "entity StressorType stressor_from_name = stressors_stresses_csv[:stressor, _]\n\ndef stressor_stress(stor,stss) = \n    stressor_from_name(stor_n, stor) and \n    stress_from_name(stss_n, stss) and \n    stressors_stresses_csv(:stressor, r, stor_n) and\n    stressors_stresses_csv(:stress, r, stss_n)\n    from stor_n, stss_n, r\ndef stress_stressor = transpose[stressor_stress]\n",
      "type": "install"
    },
    {
      "id": "c93bb080-1b2f-4731-8a3a-7275a186364a",
      "inputs": [
      ],
      "name": "un-crpt-model-urbanelement",
      "source": "entity UrbanElementType row_to_urban_element = row_from[elements_csv]\ndef urban_element_row = transpose[row_to_urban_element]\ndef urban_element = cell_from[urban_element_row, elements_csv]\n\ndef urban_element_city = urban_element:city\ndef urban_element_code = urban_element:code\ndef urban_element_short_name = urban_element:short_name\ndef urban_element_name = urban_element:name\n",
      "type": "install"
    },
    {
      "id": "54e58abd-ff55-4370-b999-7816603f3bc6",
      "inputs": [
      ],
      "name": "un-crpt-model-lib",
      "source": "/**\n  * Template for extracting an attribute of an entity from a CSV file when\n  *   that file conforms to the entity master-data pattern.\n  */\n@inline\ndef row_from[C](row) = C(_, row, _)\n\n@inline\ndef row_from[C](file_index, row) = C(file_index, _, row, _)\n\n@inline\ndef row_from_by_key[KEYSPEC,C](key) = C(ks, _, key) and KEYSPEC(ks) from ks\n\n@inline\ndef cell_from[R,C](attribute, p, v) =\n    R(p, row) and\n    C(attribute, row, v) and\n    (String(v) and not empty_string(v)\n        or\n        Date(v) and not empty_date(v) and not default_end_date(v)\n        or\n        not String(v) and not Date(v))\n    from row\n\n@inline\ndef cell_from[R,C](attribute, p, v) =\n    R(p, file_idx, row) and\n    C(file_idx, row, attribute, v) and\n    (String(v) and not empty_string(v)\n        or\n        Date(v) and not empty_date(v) and not default_end_date(v)\n        or\n        not String(v) and not Date(v))\n    from row, file_idx\n\n@inline\ndef cell_from_by_key[KEYSPEC,R,C](attribute, p, v) =\n    exists(ks, row, key: KEYSPEC(ks) and\n        R(p, key) and\n        C(ks, row, key) and\n        C(attribute, row, v) and\n        (String(v) and not empty_string(v)\n            or\n            Date(v) and not empty_date(v) and not default_end_date(v)\n            or\n            not String(v) and not Date(v))\n    )\n\n@inline\ndef cell_is_true[R](attribute, p) = R[attribute](p, yes_code)\n\n/**\n * Helper rules to convert between date and datetime\n */\n@inline \ndef datetime_to_date(dttm, dt) =\n    dt = parse_date[format_datetime[dttm, \"Y-m-d\", \"00:00\"],\"Y-m-d\"]\n\n@inline \ndef date_to_datetime(dt, dttm) =\n    year_0 = date_year[datetime_to_date[nanoseconds_to_datetime[0]]] and\n    y = date_year[dt] and \n    d = date_dayofyear[dt] and\n    leap_d = count[\n        (x,(modulo[x, 4] = 0 and not modulo[x, 100] = 0) or modulo[x, 400] = 0)\n        from x in range[year_0, y - 1, 1]] and \n    dttm = nanoseconds_to_datetime[ ((y - year_0) * 365 + leap_d + d - 1) * 86400000000000]\n    from y, d, year_0, leap_d\n    \n/**\n  * Type definitions\n  */\ndef Age = range[0, 120, 1]\ndef YesOrNo = yes_code ; no_code\n\ndef yes_code = { \"y\"; \"Y\"; \"yes\"; \"YES\", \"Yes\" }\ndef no_code = { \"n\"; \"N\"; \"no\"; \"NO\", \"No\" }\n\ndef empty_date = parse_date[\"0001-01-01\", default_date_format]\ndef default_end_date = parse_date[\"9999-12-31\", default_date_format]\ndef default_date_format = \"Y-m-d\"\ndef default_end_datetime = parse_datetime[\"9999-12-31T23:59:59\", default_datetime_format]\ndef default_datetime_format = \"Y-m-dTH:M:S\"\ndef empty_string = \"\"\n\n@inline\ndef valid_value(v) =\n    String(v) and not empty_string(v)\n    or\n    Date(v) and not empty_date(v) and not default_end_date(v)\n    or\n    not String(v) and not Date(v)\n\n/**\n  * Note: the function below uses floor() on the difference to obtain an integer\n  * difference between the first and the second parameters (order is important)\n  */\n@inline\ndef difference_in_months = dt1, dt2, m_diff:\n    t1 = datetime_to_nanoseconds[date_to_datetime[dt1]] and \n    t2 = datetime_to_nanoseconds[date_to_datetime[dt2]] and \n    diff_ns = t1 - t2 and\n    diff_dttm = nanoseconds_to_datetime[diff_ns] and\n    date_0 = nanoseconds_to_datetime[0] and\n    m_diff = \n        (datetime_year[diff_dttm, \"00:00\"] - datetime_year[date_0, \"00:00\"]) * 12 + \n        datetime_month[diff_dttm, \"00:00\"] - datetime_month[date_0, \"00:00\"]\n    from t1, t2, diff_ns, diff_dttm, date_0\n",
      "type": "install"
    }
  ],
  "metadata": {
    "notebookFormatVersion": "0.0.1"
  }
}